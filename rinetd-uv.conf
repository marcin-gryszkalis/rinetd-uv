# rinetd-uv.conf - example configuration

# Global options
logfile /var/log/rinetd-uv.log
# logcommon  # Use Apache-style logging

# PID file
pidfile /var/run/rinetd-uv.pid

# Buffer size configuration (1KB - 1MB, default: 65536)
# Smaller values reduce memory usage and latency, larger values improve throughput
buffersize 65536  # 64KB is the default

# Buffer pool configuration (reduces allocation overhead)
# Min buffers to keep (0-10000, default: 64)
pool-min-free 64
# Max buffers before trimming (1-100000, default: 1024)
pool-max-free 1024
# Time before freeing excess, in milliseconds (100-300000, default: 60000)
pool-trim-delay 60000

# DNS refresh interval (default: 600 seconds = 10 minutes)
# Automatically re-resolves backend hostnames at specified intervals
# Set to 0 to disable, or override per-rule with [dns-refresh=N]
dns-refresh 600

# Listen backlog (1-65535, default: 128)
# Higher values allow more pending connections during bursts
listen-backlog 128

# Maximum UDP connections per forwarding rule (1-1000000, default: 5000)
max-udp-connections 5000

# Status reporting (writes JSON/text file with runtime statistics)
statusfile /var/log/rinetd-uv_status.json
statusinterval 30
statusformat json

# Statistics logging interval (one-line summary to log file)
statsloginterval 60

# Global Access Control:
# You may specify global allow and deny rules here.
# Only ip addresses are matched, hostnames cannot be specified here.
# The wildcards you may use are * and ?
#
allow 192.168.2.*
deny 192.168.2.1?
allow fe80:*
deny 2001:618:*:e43f

# You can split your configuration across multiple files
include /etc/rinetd-uv.d/*.conf
# include conf.d/servers.conf

# Forwarding options:
# Format: bindaddress bindport connectaddress connectport [options]
# Options: [timeout=seconds,src=sourceaddress,keepalive=on/off,dns-refresh=seconds,mode=octal]
# Note: TCP keepalive is enabled by default
# Note: mode option sets Unix socket file permissions (e.g. mode=0660)

# TCP forwarding examples
0.0.0.0 80/tcp 192.168.1.10 8080/tcp
192.168.0.1 https server.example.com 8443 [src=192.168.1.1]
0.0.0.0 444 api.example.com 444 [dns-refresh=60]
:: http ipv6.google.com http

# UDP forwarding example
0.0.0.0 53/udp 8.8.8.8 53/udp [timeout=30]

# Unix domain socket forwarding examples
# TCP to Unix socket - Docker socket proxy
0.0.0.0 2375/tcp unix:/var/run/docker.sock
# Unix to TCP forwarding with restricted permissions
unix:/var/run/myapp.sock 192.168.1.100 8080/tcp [mode=0660]

# Per-rule Access Control (applies to previous forwarding rule)
0.0.0.0 22 192.168.1.20 22
allow 10.0.0.*

